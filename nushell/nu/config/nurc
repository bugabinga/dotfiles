# This is an initial script for nushell
# It is expected that it is sourced in the `config.toml`:
# `startup = ["source ~/.config/nushell/nurc"]`

# GLOBAL VARIABLES
let TODO_FILE = D:/Notizen/TODO.md
let NURC = (build-string (config path | path dirname) /nurc)
let OS = (sys).host.name

# ALIASES
alias cat = bat
alias vim = nvim
alias edit = nvim
alias sudo = gsudo
alias doas = sudo
alias grep = rg

# CUSTOM LITTLE JAVA COMMANDS
alias sha = java_tool sha
alias uuid = java_tool random_uuid
alias download = java_tool download
alias download_jar = java_tool download_jar

# FUNCTIONS

# Wrapper function to launch my custom java tool scripts.
# This function handles the different paths the tools can have on different hosts.
def java_tool [ 
  name: string # name of the custom java tool script without the .java extension 
] {
  # the paths are assumed to have already been linked from dotfiles
  if $OS == "Windows" {
    java (build-string X:/tools/ $name .java)
  } {
    java (build-string ~/.local/tools/ $name .java)
  }
}

def man [
  program: string
] {
  if $OS == "Windows" {
    start (build-string https://man.cx/ $program)
  } {
    exec man $program
  }
}

# Search the given query on the web with the default browser in DuckDuckGo.
def web [
  query:string # The search query
] {
    # There seems to be an issue with the nu start command on windows: It does not handle URLs
    # Using windows command for now:
    start (build-string "https://duckduckgo.com/?q=" $query)
}

# Browse and select files in the current directory with an interactive file viewer.
def files [
  ...rest # Arguments will be passed to fzf
] {
  let options = ["--ansi", "--info", "inline"]
  let layout = ["--height", "100%", "--layout", "reverse", "--border", "--preview-window", "up:1:noborder:66%"]
  let color = ["--color", "fg:#adadad,fg+:#78aba9,bg:#333333,preview-bg:#222222,border:#547877"]
  let preview = ["--preview", "bat --color=always --italic-text=always --decorations=never --line-range :300 {}"]
  fzf $options $layout $color $preview $rest
}

# Show or add to bugabingas TODO file.
def todo [
  --edit (-e)   # Edit the todo file in $EDITOR
  item?: string # New TODO item to append to TODO file
] {
  if ($edit | empty?) {
    # How is one supposed to check the optional variable if it is not in scope, when not given?
    #if $(= $item | empty?) {
      glow $TODO_FILE
      # } {
      # appending a line to a file seems kind of sus in nushell right now... ask on discord about this?
      # open $TODO_FILE | lines | append $(build-string "- " $item) | save $TODO_FILE
      # }
  } {
    # Is this the nu way of running dynamic commands?
    nu --commands (build-string $nu.env.EDITOR " " $TODO_FILE)
  }
}
